<div align="center">
    <a href="https://inspatial.io" target="_blank">
    <picture>
        <source media="(prefers-color-scheme: light)" srcset="https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/icon-brutal-light.svg">
        <source media="(prefers-color-scheme: dark)" srcset="https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/icon-brutal-dark.svg">
        <img src="https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/icon-brutal-dark.svg" alt="InSpatial" width="300"/>
    </picture>
    </a>

<br>
   <br>

<a href="https://inspatial.io" target="_blank">
<p align="center">
    <picture>
        <source media="(prefers-color-scheme: light)" srcset="https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/logo-light.svg">
        <source media="(prefers-color-scheme: dark)" srcset="https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/logo-dark.svg">
        <img src="https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/logo-dark.svg" height="75" alt="InSpatial">
    </picture>
</p>
</a>

_Reality is your canvas_

<h3 align="center">
    InSpatial is a universal development environment (UDE) <br> for building cross-platform and spatial (AR/MR/VR) applications
  </h3>

[![InSpatial Dev](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/dev-badge.svg)](https://www.inspatial.dev)
[![InSpatial Cloud](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/cloud-badge.svg)](https://www.inspatial.cloud)
[![InSpatial App](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/app-badge.svg)](https://www.inspatial.io)
[![InSpatial Store](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/store-badge.svg)](https://www.inspatial.store)

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![Discord](https://img.shields.io/badge/discord-join_us-5a66f6.svg?style=flat-square)](https://discord.gg/inspatiallabs)
[![Twitter](https://img.shields.io/badge/twitter-follow_us-1d9bf0.svg?style=flat-square)](https://twitter.com/inspatiallabs)
[![LinkedIn](https://img.shields.io/badge/linkedin-connect_with_us-0a66c2.svg?style=flat-square)](https://www.linkedin.com/company/inspatiallabs)

</div>

##

<div align="center">

| InSpatial                                                                                                                     | Description                          | Link                                           |
| ----------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ | ---------------------------------------------- |
| [![InSpatial Dev](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/dev-badge.svg)](https://www.inspatial.dev)       | Universal Libraries & Frameworks     | [inspatial.dev](https://www.inspatial.dev)     |
| [![InSpatial Cloud](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/cloud-badge.svg)](https://www.inspatial.cloud) | Backend APIs and SDKs                | [inspatial.cloud](https://www.inspatial.cloud) |
| [![InSpatial App](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/app-badge.svg)](https://www.inspatial.io)        | Build and manage your InSpatial apps | [inspatial.app](https://www.inspatial.io)      |
| [![InSpatial Store](https://inspatial-storage.s3.eu-west-2.amazonaws.com/media/store-badge.svg)](https://www.inspatial.store) | Deploy and discover InSpatial apps   | [inspatial.store](https://www.inspatial.store) |

</div>

---

## 🔍 Interact (🟢 Stable)

Universal interactivity and state management system for cross-platform and spatial applications.

### 👨‍💻 What Can I Do With Interact?

- **Build Reactive Applications**: Create dynamic interfaces with automatic updates when data changes
- **Manage Complex State**: Handle application state with validation, persistence, and expressive updates
- **Optimize Performance**: Enjoy fine-grained updates that only re-render what actually changed
- **Create Spatial Experiences**: Power AR/VR/MR applications with reactive 3D state management
- **Universal Development**: Write once, run everywhere - web, mobile, native, and XR platforms

## 🌟 Features

### 🚀 Core Features

- 🎯 **Fine-Grained Reactivity** - Surgical updates that only re-render what actually changed
- 🔄 **Automatic Dependency Tracking** - Zero-config reactive dependencies with no manual subscriptions
- ⚡ **Signal Primitives** - Lightweight reactive containers with `createSignal`, `computed`, `watch`
- 📦 **Batched Updates** - Intelligent update scheduling prevents unnecessary re-renders
- 🎮 **Signal Operations** - Rich API with `.eq()`, `.gt()`, `.and()`, `.between()` and 30+ operators
- 🔗 **Signal Composition** - Merge, derive, and extract patterns for complex state relationships
- 🎛️ **State Management** - Transform plain objects into reactive signal-based state
- ⚙️ **Action System** - Structured mutations with throttling, debouncing, and validation
- 💾 **Automatic Persistence** - Multi-backend storage with localStorage, sessionStorage, and custom adapters
- 🎪 **Universal Triggers** - Cross-platform event handling from DOM to native to XR
- 🧩 **Extension System** - Modular architecture for custom triggers, directives, and functionality

### 🌐 Universal Capabilities

- 🌍 **Universal Runtime** - Works seamlessly in Node.js, Deno, Bun, browsers, and native environments
- 📱 **Cross-Platform** - Single codebase runs on Web, Mobile, Native, and XR platforms
- 🛡️ **TypeScript First** - Complete type safety with intelligent inference and autocomplete
- 🔄 **Automatic Cleanup** - Memory-safe with automatic effect disposal and garbage collection
- ⏱️ **Precise Scheduling** - Fine-grained control over effect timing and execution order
- 🎨 **Framework Agnostic** - Works with any UI framework or vanilla JavaScript
- 🔧 **Developer Experience** - Hot reload support, debugging tools, and comprehensive error messages
- 🚀 **Performance Optimized** - Minimal bundle size with tree-shaking and zero runtime overhead
- 🔌 **Extensible Architecture** - Plugin system for custom functionality and third-party integrations

## 🔮 Coming Soon

- 🌐 **Intent** - Intentional/predictive prefetch for server state
- 📊 **Time Travel Debugging** - Replay state changes and signal updates
- 🤖 **AI-Powered State** - Intelligent state optimization and prediction

## 📦 Install Interact:

Choose your preferred package manager:

```bash
deno install jsr:@in/teract
```

##

```bash
npx jsr add @in/teract
```

##

```bash
yarn dlx jsr add @in/teract
```

##

```bash
pnpm dlx jsr add @in/teract
```

##

```bash
bunx jsr add @in/teract
```

## 🚀 Quick Start Guide

### 1. **Signal**

```typescript
// Option 1: Basic Counter with Computed Signal
import { createSignal, nextTick, $ } from "@in/teract/signal";

const count = createSignal(0);
const doubled = $(() => count.value * 2);

console.log(doubled.value); // 0
count.value = 5;

nextTick(() => {
  console.log(doubled.value); // 10
});
```

```typescript
// Option 2: Basic with effect
import { createSignal, nextTick, watch } from "@in/teract/signal";

const count = createSignal(0);

// Watch for changes
const dispose = watch(() => {
  console.log("Count changed:", count.value);
});

count.value = 1; // Logs: "Count changed: 1"

nextTick(() => {
  count.value = 2; // Logs: "Count changed: 2"
});

// Clean up the effect
dispose();
```

### 2. **State Management**

```typescript
// Separation Pattern - Create state, actions, and storage separately
import { createState, createAction, createStorage } from "@in/teract/state";

// 1. Create State
const gameState = createState({ 
  health: 100, 
  score: 0, 
  level: 1 
});

// 2. Create Actions (optional)
const gameActions = createAction(gameState, {
  takeDamage: { key: 'health', fn: (h, damage = 10) => Math.max(0, h - damage) },
  addScore: { key: 'score', fn: (s, points = 100) => s + points },
  levelUp: { key: 'level', fn: (l) => l + 1 }
});

// 3. Create Storage (optional)
const cleanup = createStorage(gameState, {
  key: 'game-save',
  backend: 'local',
  exclude: ['health'] // Don't persist health
});

// Usage
gameActions.takeDamage(25);
gameActions.addScore(500);
console.log(gameState.health.value); // 75
```

```typescript
// Explicit Pattern - Everything configured upfront
import { createState } from "@in/teract/state";

const gameState = createState({
  id: "game-state",
  initialState: { health: 100, score: 0, level: 1 },
  
  // Actions defined inline
  action: {
    takeDamage: { key: 'health', fn: (h, damage = 10) => Math.max(0, h - damage) },
    addScore: { key: 'score', fn: (s, points = 100) => s + points },
    levelUp: { key: 'level', fn: (l) => l + 1 }
  },
  
  // Storage configured inline
  storage: [
    { key: 'game-save', backend: 'local', exclude: ['health'] },
    { key: 'game-session', backend: 'session' }
  ]
});

// Usage - actions are available on the state
gameState.action.takeDamage(25);
gameState.action.addScore(500);

// Dynamic management
gameState.addAction('heal', { key: 'health', fn: (h) => Math.min(100, h + 20) });
gameState.addStorage({ key: 'cloud-save', backend: 'memory' });
```

### 3. **Trigger System & Event Handling**

```jsx
import { InTrigger, createTrigger } from "@in/teract/trigger";
import { Button, Slot } from "@in/widget";

// Built-in universal triggers work across platforms
<Button 
  on:tap={() => console.log('Tapped!')}
  on:longpress={() => console.log('Long pressed!')}
  on:hover={(isHovering) => console.log('Hover:', isHovering)}
  on:key={({ key, phase }) => console.log(`Key ${key} ${phase}`)}
  on:escape={() => console.log('Escape pressed!')}
  on:gamepad={(info) => console.log('Gamepad:', info)}
  
  // Platform-specific events
  on:click={() => console.log('DOM click')}
  on:pointerdown={() => console.log('DOM pointer')}
  
  // Capacitor app events
  on:back={() => console.log('Android back')}
  on:resume={() => console.log('App resumed')}
  on:urlopen={(data) => console.log('Deep link:', data)}
>
  Interactive Button
</Button>

// Create custom triggers
createTrigger('swipe', (node, handler) => {
  let startX = 0, startY = 0;
  
  node.addEventListener('pointerdown', (e) => {
    startX = e.clientX;
    startY = e.clientY;
  });
  
  node.addEventListener('pointerup', (e) => {
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    
    if (Math.abs(deltaX) > 50 || Math.abs(deltaY) > 50) {
      handler({ 
        type: 'swipe', 
        direction: Math.abs(deltaX) > Math.abs(deltaY) 
          ? (deltaX > 0 ? 'right' : 'left')
          : (deltaY > 0 ? 'down' : 'up'),
        distance: Math.sqrt(deltaX * deltaX + deltaY * deltaY)
      });
    }
  });
}, {
  platforms: ['dom', 'native'],
  fallback: 'tap'
});

// Use custom trigger
<Slot on:swipe={({ direction, distance }) => 
  console.log(`Swiped ${direction} for ${distance}px`)
}>
  Swipe me!
</Slot>
```

### 4. **Extension System**

```typescript
import { createExtension } from "@in/teract/extension";

// Create a custom extension
const MyExtension = createExtension({
  meta: {
    key: "my-extension",
    name: "My Custom Extension",
    description: "Adds custom functionality to InSpatial",
    author: { name: "Your Name" },
    version: "1.0.0"
  },
  
  scope: {
    clientScope: "progressive",
    editorScopes: ["Windows", "Scenes"]
  },
  
  permissions: {
    network: { domains: ["api.example.com"] },
    storage: { local: true },
    renderer: { props: true, directives: ["my"] }
  },
  
  capabilities: {
    // Add custom trigger props
    triggers: {
      'my-event': {
        handler: (node, value) => {
          node.addEventListener('custom', value);
        },
        platforms: ['dom'],
        description: 'Custom event handler'
      }
    },
    
    // Add custom renderer props
    rendererProps: {
      onDirective: (prefix, key, prop) => {
        if (prefix === 'my') {
          return (node, value) => {
            node.setAttribute(`data-my-${key}`, value);
          };
        }
      },
      
      namespaces: {
        'my': 'https://example.com/my-namespace'
      },
      
      tagAliases: {
        'MyButton': 'button'
      }
    }
  },
  
  lifecycle: {
    setup: (renderer) => {
      console.log('Extension setup with renderer:', renderer);
    },
    
    onInstall: () => {
      console.log('Extension installed');
    },
    
    validate: () => {
      if (!window.customAPI) {
        throw new Error('Custom API not available');
      }
    }
  }
});

// Use extension in renderer
import { createRenderer } from "@inspatial/kit/renderer";

createRenderer({
  mode: "auto",
  extensions: [InTrigger, MyExtension]
}).then((InSpatial) => {
  InSpatial.render(document.getElementById("app"), App);
});

// Use extension features
<Slot 
  my:custom="value"
  on:my-event={() => console.log('Custom event!')}
>
  Extended functionality
</Slot>
```

## 📚 Core Concepts

### Signal System

InSpatial's signal system provides fine-grained reactivity with automatic dependency tracking:

```typescript
import { createSignal, computed, watch, merge } from "@in/teract/signal";

// Basic signals
const count = createSignal(0);
const name = createSignal("Charlotte");

// Computed signals (derived values)
const doubled = computed(() => count.value * 2);
const greeting = computed(() => `Hello, ${name.value}!`);

// Signal operations
const isPositive = count.gt(0);
const isEven = computed(() => count.value % 2 === 0);
const isValidCount = count.between(0, 100);

// Merge multiple signals
const summary = merge([count, name], (c, n) => 
  `${n} has ${c} points`
);

// Effects for side effects
const dispose = watch(() => {
  console.log(`Count is now: ${count.value}`);
});

// Enhanced subscriptions with context
count.on('change', (newVal, oldVal, context) => {
  console.log(`Changed from ${oldVal} to ${newVal} via ${context}`);
});

// Manual triggering for object mutations
const user = createSignal({ name: "Ben", age: 24 });
user.value.age = 31; // Mutate object
user.trigger(); // Manually notify of change
```

# signal

#### A comprehensive reactive state management and interactivity system

Interact is a streamlined reactivity system that helps you manage changing data in your application. Think of it like a notification system where values can announce when they change, and other parts of your code can listen and react accordingly.

## Overview

InSpatial Interact provides the essential building blocks for reactive programming:

- **Signals**: Containers for values that notify listeners when they change
- **Computed Values**: Values derived from signals that update automatically
- **Effects**: Functions that run when their dependencies change
- **State Management**: Convert plain objects into reactive signal-based state
- **Actions**: Structured state mutations with throttling and debouncing
- **Storage**: Automatic persistence with multiple storage backends
- **Triggers**: Universal event handling across platforms
- **Extensions**: Reusable functionality that enhances InSpatial's capabilities

This is the lightweight alternative to the full InSpatial Interactivity system and state managers, decoupled from any rendering logic making it an agnostic system that can work with any framework. Signal APIs are self-contained and work at the component level without an interactive root hoisted at app context tree.

## 📖 API Reference

### Signal API

```typescript
// Core signal creation
createSignal<T>(value: T): Signal<T>
computed<T>(fn: () => T): Signal<T>
$(fn: () => T): Signal<T> // Alias for computed

// Signal methods
signal.get(): T                    // Get current value (reactive)
signal.set(value: T): void         // Set new value
signal.peek(): T                   // Get value (non-reactive)
signal.poke(value: T): void        // Set value (non-reactive)
signal.trigger(): void             // Manually trigger updates
signal.subscribe(fn: (T) => void): () => void  // Subscribe to changes
signal.on('change', fn: (new, old, context) => void): () => void

// Signal operations
signal.eq(other): Signal<boolean>      // Equal comparison
signal.neq(other): Signal<boolean>     // Not equal
signal.gt(other): Signal<boolean>      // Greater than
signal.lt(other): Signal<boolean>      // Less than
signal.gte(other): Signal<boolean>     // Greater than or equal
signal.lte(other): Signal<boolean>     // Less than or equal
signal.and(other): Signal<T | U>       // Logical AND
signal.or(other): Signal<T | U>        // Logical OR
signal.inverse(): Signal<boolean>      // Logical NOT
signal.hasValue(): boolean             // Check if not nullish
signal.between(min, max): Signal<boolean>  // Range check
signal.isEmpty(): Signal<boolean>      // Check if empty (arrays/strings)
signal.includes(item): Signal<boolean> // Check if includes item

// Utilities
read<T>(value: SignalValueType<T>): T
write<T>(signal: Signal<T>, value: T | ((prev: T) => T)): T
peek<T>(value: SignalValueType<T>): T
merge<T[], R>(signals: T, fn: (...args) => R): Signal<R>
derive<T, K>(signal: Signal<T>, key: K): Signal<T[K]>
extract<T, K>(signal: Signal<T>, ...keys: K[]): { [P in K]: Signal<T[P]> }
```

### State API

```typescript
// State creation
createState<T>(initialState: T): State<T>
createState<T>(config: StateConfig<T>): State<T> & EnhancedFeatures

// State interface
interface State<T> {
  [K in keyof T]: Signal<T[K]>;
  batch(fn: (state) => void): void;
  reset(): void;
  snapshot(): T;
  subscribe(fn: (snapshot: T) => void): () => void;
}

// Action creation
createAction<T>(signal: Signal<T>, fn: (current: T, ...args) => T, options?: ActionTriggerProps): (...args) => void
createAction<T, K>(target: [State<T>, K], fn: (current: T[K], ...args) => T[K], options?: ActionTriggerProps): (...args) => void
createAction<T>(state: State<T>, actions: TriggerDefsFor<T>): TriggerFunctionsFromDefs<T>

// Storage creation
createStorage<T>(state: State<T>, options: StorageProps): () => void
createMemoryStorage(): StorageExtensionProp
```

### Trigger API

```typescript
// Trigger creation
createTrigger<T>(name: string, handler: TriggerPropHandler<T>, options?: {
  platforms?: PlatformType[];
  fallback?: string;
  priority?: number;
}): void

// Extension creation
createExtension(props: ExtensionProps): RendererExtension

// Built-in triggers
type UniversalTriggers = 
  | 'tap' | 'longpress' | 'rightclick' | 'escape'
  | 'key' | 'key:down' | 'key:up'
  | 'mount' | 'beforeMount' | 'frameChange'
  | 'change' | 'submit' | 'focus'
  | 'hover' | 'hoverstart' | 'hoverend'
  | 'gamepad' | 'gamepadconnect' | 'gamepaddisconnect'
  | 'back' | 'resume' | 'pause' | 'urlopen' | 'statechange' | 'restored'
```

## 🤝 Contributing

We welcome contributions to InSpatial Interact! Please read our [Contributing Guidelines](CONTRIBUTING.md) to get started.

---

## 📄 License

InSpatial Kit is released under the Intentional 1.0 License. See the [LICENSE](LICENSE) file for details.

---

<div align="center">
  <strong>Ready to build the future of interactive applications?</strong>
  <br>
  <a href="https://www.inspatial.io">Start Building with InSpatial Interact</a>
</div>
